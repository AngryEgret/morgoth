

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Getting Started &mdash; Morgoth 1 documentation</title>
    
    <link rel="stylesheet" href="_static/extra.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="top" title="Morgoth 1 documentation" href="index.html" />
    <link rel="next" title="Configuration" href="configuration.html" />
    <link rel="prev" title="About" href="about.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="configuration.html" title="Configuration"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="about.html" title="About"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Morgoth 1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="getting-started">
<h1><a class="toc-backref" href="#id1">Getting Started</a><a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h1>
<p>To get started using morgoth follow one of these simple exercises below
or start by reading the configuration, and components section of this documentation
to learn how to start using morgoth for your own project.</p>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#getting-started" id="id1">Getting Started</a><ul>
<li><a class="reference internal" href="#setting-anomaly-detection-of-error-rates-for-your-app" id="id2">Setting anomaly detection of error rates for your app</a><ul>
<li><a class="reference internal" href="#install-morgoth" id="id3">Install Morgoth</a></li>
<li><a class="reference internal" href="#running-morgoth" id="id4">Running Morgoth</a></li>
<li><a class="reference internal" href="#send-graphite-data-to-morgoth" id="id5">Send graphite data to Morgoth</a></li>
<li><a class="reference internal" href="#detecting-your-first-anomaly" id="id6">Detecting your first anomaly</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="setting-anomaly-detection-of-error-rates-for-your-app">
<h2><a class="toc-backref" href="#id2">Setting anomaly detection of error rates for your app</a><a class="headerlink" href="#setting-anomaly-detection-of-error-rates-for-your-app" title="Permalink to this headline">¶</a></h2>
<div class="section" id="install-morgoth">
<h3><a class="toc-backref" href="#id3">Install Morgoth</a><a class="headerlink" href="#install-morgoth" title="Permalink to this headline">¶</a></h3>
<p>First lets install morgoth and its dependecies.</p>
<div class="highlight-python"><pre>
python2.6

dateutil
gevent
flask
scipy
numpy
pyyaml
wtforms

pymongo -- If using MongoDB data engine
influxdb -- If using InfluxDB data engine

</pre>
</div>
<p>Next checkout the code and add it to your PYTHONPATH.</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nv">$ </span>git clone https://github.com/nvcook42/morgoth.git
<span class="nv">$ </span><span class="nb">cd </span>morgoth
<span class="nv">$ </span><span class="nb">source</span> ./pythonpath.sh
</pre></div>
</div>
</div>
<div class="section" id="running-morgoth">
<h3><a class="toc-backref" href="#id4">Running Morgoth</a><a class="headerlink" href="#running-morgoth" title="Permalink to this headline">¶</a></h3>
<p>Choose either the MongoDB or InfluxDB example configs. Modify them if necessary,
by default they point to localhost for their data store. For InfluxDB you will
have to either create a database named morgoth with user and password morgoth, or
change the config.</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nv">$ </span>cp &lt;mongodb,influxdb&gt;.example.yaml myproject.yaml
</pre></div>
</div>
<p>Once you have setup your config start up morgoth</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nv">$ </span>./morgoth -c myproject.yaml
</pre></div>
</div>
<p>The process should remain in the foreground and print out some simple debug messages.</p>
</div>
<div class="section" id="send-graphite-data-to-morgoth">
<h3><a class="toc-backref" href="#id5">Send graphite data to Morgoth</a><a class="headerlink" href="#send-graphite-data-to-morgoth" title="Permalink to this headline">¶</a></h3>
<p>There are three ways to get graphite data into morgoth.</p>
<ul class="simple">
<li>Point your application at morgoth with the graphite fitting running</li>
<li>Use the pull graphite config fitting periodically query data from graphite</li>
<li>Configure the carbon-relay to send data to both morgoth and your existing system</li>
</ul>
<p>For simplicity in this tutorial we will follow the first option.</p>
<p>Using the example config you should see that the graphite fitting is configured and listening on port 2003.</p>
<p>Lets send some data to morgoth:</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nv">$ </span><span class="nb">echo</span> <span class="s2">&quot;graphite.test_data 42 `date +&#39;%s&#39;`&quot;</span> | nc 127.0.0.1 2003
</pre></div>
</div>
<p>Now query the api to make sure we got the data...</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nv">$ </span>curl -X GET http://localhost:7001/metrics
<span class="o">{</span>
   <span class="s2">&quot;metrics&quot;</span>: <span class="o">[</span>
      <span class="s2">&quot;graphite.test_data&quot;</span>
   <span class="o">]</span>
<span class="o">}</span>

<span class="nv">$ </span>curl -X GET http://localhost:7001/data/graphite.test_data
<span class="o">{</span>
  <span class="s2">&quot;metric&quot;</span>: <span class="s2">&quot;graphite.test_data&quot;</span>,
  <span class="s2">&quot;data&quot;</span>: <span class="o">[</span>
    <span class="o">[</span>
      <span class="s2">&quot;2014-06-13T04:53:14+00:00&quot;</span>,
      42
    <span class="o">]</span>
  <span class="o">]</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Now lets add more data and examine the dashboard to visualize the data.</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nv">$ </span><span class="k">for </span>i in <span class="o">{</span>1..9<span class="o">}</span>; <span class="k">do </span><span class="nb">echo</span> <span class="s2">&quot;graphite.test_data 0.$i `date +&#39;%s&#39;`&quot;</span> | nc 127.0.0.1 2003; sleep 1; <span class="k">done</span>
</pre></div>
</div>
<p>Now navigate to <a class="reference external" href="http://localhost:7000">http://localhost:7000</a> to see the 10 seconds or so of data.
(This dashboard is functional and thats all, if you have any design sinse at all I would gladly accept a pull request)</p>
<p>Thats it, you can add data to morgoth just like you would graphite.</p>
</div>
<div class="section" id="detecting-your-first-anomaly">
<h3><a class="toc-backref" href="#id6">Detecting your first anomaly</a><a class="headerlink" href="#detecting-your-first-anomaly" title="Permalink to this headline">¶</a></h3>
<p>Now lets detect and anomaly. The example config has just a single Threshold anomaly detector. As it is configured if 70%
of the values during the data window are above &#8216;2&#8217; than it will consider the window anomalous.</p>
<p>Lets use the load average data from your current system. Run this script to add the one minute load average every second to morgoth.</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nv">$ </span><span class="k">while </span><span class="nb">true</span>; <span class="k">do </span><span class="nb">echo</span> <span class="s2">&quot;graphite.load `cat /proc/loadavg | awk &#39;{print $1}&#39;` `date +&#39;%s&#39;`&quot;</span> | nc 127.0.0.1 2003; sleep 1; <span class="k">done</span> &amp;
</pre></div>
</div>
<p>Now lets create some cpu activity and see if we can&#8217;t get morgoth to detect it. Run this bash script to spawn
two infinite bash loops. We will kill these later.</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nv">$ </span><span class="k">for </span>i in <span class="o">{</span>1..2<span class="o">}</span>; <span class="k">do</span> <span class="o">{</span> <span class="k">while </span><span class="nb">true</span>; <span class="k">do </span><span class="nv">i</span><span class="o">=</span>0 ; <span class="k">done</span> &amp; <span class="o">}</span>; <span class="k">done</span>
</pre></div>
</div>
<p>At this point either in the dashboard or the api you should see that the load avg metric is climbing.</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nv">$ </span>curl -X GET http://localhost:7001/data/graphite.load
</pre></div>
</div>
<p>Now watch the running morgoth process logs and in a few minutes you should see a critical log about an anomalous window.
In the example configuration the detectors run on a 60s schedule. The duration parameter tells the detectors to
consider a 60s window. The period parameter tells the detectors to run their alogrithm every 60s seconds. The delay option of 0
tells the detectos to consider the most recent 60s window.</p>
<p>The anomaly should also show up as an event along the time line in the dashboard.</p>
<p>Kill the backgrounded jobs:</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nv">$ </span><span class="nb">kill</span> <span class="k">$(</span><span class="nb">jobs</span> -p<span class="k">)</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/logo_200.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Getting Started</a><ul>
<li><a class="reference internal" href="#setting-anomaly-detection-of-error-rates-for-your-app">Setting anomaly detection of error rates for your app</a><ul>
<li><a class="reference internal" href="#install-morgoth">Install Morgoth</a></li>
<li><a class="reference internal" href="#running-morgoth">Running Morgoth</a></li>
<li><a class="reference internal" href="#send-graphite-data-to-morgoth">Send graphite data to Morgoth</a></li>
<li><a class="reference internal" href="#detecting-your-first-anomaly">Detecting your first anomaly</a></li>
</ul>
</li>
</ul>
</li>
</ul>

<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="configuration.html" title="Configuration"
             >next</a> |</li>
        <li class="right" >
          <a href="about.html" title="About"
             >previous</a> |</li>
        <li><a href="index.html">Morgoth 1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Nathaniel Cook.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>