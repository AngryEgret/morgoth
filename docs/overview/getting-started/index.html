<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Getting started - Morgoth - Documentation - Morgoth - Documentation</title>
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">

  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script>
  <script src="../../js/theme.js"></script>

  <style>
    body {font-size: 90%;}
    pre, code {font-size: 100%;}
    h3, h4, h5, h6 {color: #2980b9; font-weight: 300}
  </style> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon-home"></a>
        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
      <ul class="current">
    
        
        <span>Overview</span>
            
                <li class="toctree-l1 ">
                    <a class="" href="../overview">Overview</a>
                    
                </li>
            
                <li class="toctree-l1 current">
                    <a class="current" href=".">Getting started</a>
                    
                        <ul>
                        
                            <li class="toctree-l2"><a href="#installation">Installation</a></li>
                            
                        
                            <li class="toctree-l2"><a href="#basic-configuration">Basic Configuration</a></li>
                            
                                <li><a class="toctree-l3" href="#dependencies">Dependencies</a></li>
                            
                        
                            <li class="toctree-l2"><a href="#running-morgoth">Running Morgoth</a></li>
                            
                        
                            <li class="toctree-l2"><a href="#detecting-anomalies">Detecting Anomalies</a></li>
                            
                                <li><a class="toctree-l3" href="#getting-data-into-morgoth">Getting data into Morgoth</a></li>
                            
                                <li><a class="toctree-l3" href="#getting-data-out-of-morgoth">Getting data out of Morgoth</a></li>
                            
                                <li><a class="toctree-l3" href="#querying-for-anomalies">Querying for anomalies</a></li>
                            
                        
                        </ul>
                    
                </li>
            
        

    
        
        <span>Configuration</span>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../configuration/configuration">Configuration</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../configuration/engine">Engine</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../configuration/schedule">Schedule</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../configuration/metrics">Metrics</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../configuration/fittings">Fittings</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../configuration/morgoth">Morgoth</a>
                    
                </li>
            
        

    
</ul>

      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Morgoth - Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    <li>Getting started</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="https://github.com/nvcook42/morgoth/" class="icon icon-github"> Edit on GitHub</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              <p>The following is a walk through to install, configure, and run Morgoth. It will also demonstrate
how to detect anomalies with Morgoth. This tutorial assumes a Unix like environment but the concepts
will work fine on other OSes.</p>
<h1 id="installation">Installation</h1>
<p>Morgoth is go 'gettable' simply run:</p>
<pre><code class="bash">$ go get github.com/nvcook42/morgoth
</code></pre>

<p>Morgoth should now be downloaded and installed on your system. Make sure to add
<code>$GOPATH/bin</code> to your <code>$PATH</code> in order for your system to find the newly installed morgoth binary.</p>
<p>Try it out:</p>
<pre><code class="bash">$ morgoth
</code></pre>

<p>You should see an error about morgoth not finding its configuration file. Now let's install
and configure the basic depedencies of Morgoth.</p>
<h1 id="basic-configuration">Basic Configuration</h1>
<p>Let's create a sandbox for morgoth and copy in the example configuration file:</p>
<pre><code class="bash">$ mkdir morgoth
$ cd morgoth
$ cp $GOPATH/src/github.com/nvcook42/morgoth/examples/morgoth.yaml.example ./morgoth.yaml
</code></pre>

<p>Take a look at the configuration file. All Morgoth configuration is contained in this <a href="http://en.wikipedia.org/wiki/YAML">yaml</a> file.
There are a few basic sections:</p>
<ul>
<li><strong>engine</strong> -- Defines the backend engine Morgoth should use. Currently only an <a href="http://influxdb.com">InfluxDB</a> engine is supported.</li>
<li><strong>schedule</strong> -- Defines the schedule that Morgoth down samples the incoming data stream and searches for anomalies.</li>
<li><strong>metrics</strong> -- Defines which detection algorithms to apply to which metrics.</li>
<li><strong>fittings</strong> -- Defines which methods are enabled for input and output to Morgoth. For example the REST API is configured in this section.</li>
<li><strong>morgoth</strong> -- Defines properties of the Morgoth application itself (data directories, etc). This section is absent in the example since we just need the defaults.</li>
</ul>
<p>More details of each of these sections can found in the <a href="../..//configuration/configuration">Configuration</a> section.</p>
<h2 id="dependencies">Dependencies</h2>
<h3 id="influxdb">InfluxDB</h3>
<p>Morgoth uses <a href="http://influxdb.com">InfluxDB</a> to store and process metric data. The default configuration we
just copied is looking for an InfluxDB instance to be running on <code>localhost</code> on port <code>8086</code>. It expects
to be able to login as the default root user and connect to a database called <code>morgoth</code>.</p>
<p>If you do not already have an InfluxDB instance running then I suggest using the provided Vagrantfile for InfluxDB. Just <code>cd $GOPATH/src/github.com/nvcook42/morgoth/influxdb/</code> and run
<code>vagrant up</code>. Installing <a href="https://www.vagrantup.com/">Vagrant</a> is simple and can get your environment up and running quickly.</p>
<p>At this point either create a <code>morgoth</code> database on your running InfluxDB instance or change the configuration to point to a different endpoint.</p>
<p>Now that we have InfluxDB running Morgoth is ready to start detecting anomalies.</p>
<h1 id="running-morgoth">Running Morgoth</h1>
<p>Start Morgoth again from the sandbox directory.</p>
<pre><code class="bash">$ morgoth
</code></pre>

<p>Morgoth algorithms can store metadata about what they have learned that persists from restart to restart.
This data is stored in the current directory under a <code>meta</code> directory. If you wish to change that directory
see <a href="../../configuration/morgoth/">this</a></p>
<h1 id="detecting-anomalies">Detecting Anomalies</h1>
<h2 id="getting-data-into-morgoth">Getting data into Morgoth</h2>
<p>Now that Morgoth is running lets give it some data. The example configuration has configured Morgoth to
listen on port <code>2003</code> for graphite structured metrics.</p>
<p>Let's with start a simple example using the load on the host runing Morgoth. The <a href="#">MGOF</a> algorithm, while simple,
requires that the data be bounded. Since load data isn't really bounded we will just use a good approximation.
Edit the configuration and set the <code>max</code> value in the <code>metrics</code> section to 1.5 times the number of CPUs on the 
host. Like this:</p>
<pre><code class="yaml">metrics:
 - pattern: .*
   detectors:
     - mgof:
         min: 0
         max: 6 #NUM_CPUS * 1.5
</code></pre>

<p>Now let's start a background process to send the load metric to morgoth every second.</p>
<pre><code class="bash">$ while true; do echo &quot;load $(cat /proc/loadavg | awk '{print $1}') $(date +'%s')&quot; | nc localhost 2003; sleep 1; done &amp;
</code></pre>

<p>At this point Morgoth should be receiving the load of the host every second.</p>
<h2 id="getting-data-out-of-morgoth">Getting data out of Morgoth</h2>
<p>Morgoth has a REST API listening on port <code>7000</code> by default. Simply curl the data to see the load metrics so far.</p>
<pre><code class="bash">$ curl -X GET http://localhost:7000/data/load
</code></pre>

<p>You should see some JSON that lists several data points since we started reporting load to Morgoth.</p>
<p>Now we wait... Morgoth is detecting anomalies and does so by comparing one period of time to the next.</p>
<p>While we wait let's learn about <a href="../../configuration/schedule/">schedules</a>.</p>
<p>The default configuration schedule looks like this:</p>
<pre><code class="yaml">schedule:
  rotations:
    - {period: 2m, resolution: 2s}
    - {period: 4m, resolution: 4s}
    - {period: 8m, resolution: 8s}
    - {period: 24m, resolution: 24s}
  delay: 15s
</code></pre>

<p>The smallest rotation is 2 minutes and the default <code>normal_count</code> for the MGOF algorithm is <code>3</code>. This means that
we need to wait 6 minutes before Morgoth will consider the load metric as not anomalous(aka normal).</p>
<p>This gives us a chance to query for detected anomalies since the first several rotations will be considered anomalous.</p>
<h2 id="querying-for-anomalies">Querying for anomalies</h2>
<p>The Morgoth REST API also has an endpoint for querying anomalies. Run this curl command:</p>
<pre><code class="bash">$ curl -X GET http://localhost:7000/anomalies/load
</code></pre>

<p>If it has been a few minutes than there should be a few anomalies recored so far.</p>
<p>Now we need to wait until Morgoth no longer marks any rotations as anomalous.</p>
<p>Once a few minutes have past without any 'anomalies' let's create a real anomaly for Morgoth to find.</p>
<p>Run this command to create some pointless be real load.</p>
<pre><code class="bash">$ for i in {1..2}; do { while true; do true ; done &amp; }; done
</code></pre>

<p>This command created two inifite while loops just spinning on the cpu. This should increase the load to at least 2 on the system.
Let this run for a few minutes.</p>
<p>Once you are statisfied that Morgoth was able to detect this anomaly you can kill both the while loops and the loops sending data to Morgoth
via this command:</p>
<pre><code class="bash">$ kill $(jobs -p)
</code></pre>


            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../configuration/configuration" class="btn btn-neutral float-right" title="Configuration"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../overview" class="btn btn-neutral" title="Overview"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
    <!-- Copyright etc -->
    </p>
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
        
            <a class="icon icon-github" style="float: left; color: #fcfcfc" href="https://github.com/nvcook42/morgoth/"> GitHub</a>
        
      <span><a href="../overview" style="color: #fcfcfc;">&laquo; Previous</a></span>
      <span style="margin-left: 15px"><a href="../../configuration/configuration" style="color: #fcfcfc">Next &raquo;</a></span>
    </span>
</div>
</body>
</html>