<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="Nathaniel Cook">
  
  <title>Detection framework - Morgoth - Documentation</title>
  

  <link rel="shortcut icon" href="../favicon.ico">
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "Detection framework";
    var mkdocs_page_input_path = "detection_framework.md";
    var mkdocs_page_url = "/detection_framework/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script>
  <script src="../js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Morgoth - Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="..">Home</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../overview/">Overview</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../getting-started/">Getting started</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../configuration/">Configuration</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 current">
        <a class="current" href="./">Detection framework</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#detection-framework">Detection Framework</a></li>
                
                    <li><a class="toctree-l4" href="#lossy-counting">Lossy Counting</a></li>
                
                    <li><a class="toctree-l4" href="#what-is-considered-anomalous">What is considered anomalous?</a></li>
                
                    <li><a class="toctree-l4" href="#putting-it-all-together">Putting it all together</a></li>
                
            
            </ul>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../fingerprints/">Fingerprints</a>
        
    </li>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Morgoth - Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Detection framework</li>
    <li class="wy-breadcrumbs-aside">
      
        
          <a href="https://github.com/nathanielc/morgoth/" class="icon icon-github"> Edit on GitHub</a>
        
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="detection-framework">Detection Framework</h1>
<p>There are two basic components to the detection framework Morgoth employs.</p>
<ol>
<li>A Lossy Counting strategy for finding anomlous behavior.</li>
<li>A fingerprinting mechanism to summarize/fingerprint behaviors.</li>
</ol>
<p>At a high level Morgoth fingerprints each window of data it sees and keeps track of which fingerprints it has seen before and marks new/infrequent fingerprints as anomalous.
The power of the framework is in which fingerprinting algorithms are used and in the simplicity of configuring how to count frequent fingerprints.</p>
<h2 id="lossy-counting">Lossy Counting</h2>
<p>The <a href="http://www.vldb.org/conf/2002/S10P03.pdf">Lossy Counting algorithm</a> is a way of counting frequent items efficiently.
The algorithm is lossy since it will drop infrequent items but does so in such a way that it can guarantee certain behaviors:</p>
<ol>
<li>There are no false negatives. The frequency of an item cannot be over estimated.</li>
<li>False positives are guaranteed to have a frequency of at least <code>mN-eN</code>, where <code>N</code> is the number of items processed, <code>m</code> is the minimum support and <code>e</code> is the error tolerance.</li>
<li>The frequency of an item can be underestimated by at most <code>eN</code>.</li>
<li>The space requirements of the algorithm are <code>1/e log(eN)</code>.</li>
</ol>
<p>These constraints allow the user to have intuitive control over what is considered an anomaly.
For example #3 states that items can be underestimated by at most <code>eN</code>.
What this means given an <code>e = 0.10</code>, items that are less than 10% frequent could be underestimated to have 0% frequency as a worst case.
As result these items would get dropped from the algorithm and when they occur again will be marked as anomalies.
By settings the error tolerance and minimum support one can control how lossy the counting alogorithm is for a given use case.</p>
<p>Notice that <code>m &gt; e</code>, this is so that we reduce the number of false positives.
For example say we set <code>e = 5%</code> and <code>m = 5%</code>.
If a <em>normal</em> behavior X, has a true frequency of 6% than based on variations in the true frequency, X might fall below 5% for a small interval and be dropped.
This will cause X's frequency to be underestimated, which will cause it to be flagged as an anomaly, since its estimated frequency falls below the <code>minimum support</code>.
The anomaly is a false positive because its true frequency is greater then the <code>minimum support</code>.
By setting <code>e &lt; m</code> we have a buffer to help mitigate creating false positives.</p>
<h2 id="what-is-considered-anomalous">What is considered anomalous?</h2>
<p>The answer is simple; every time the Lossy Counting algorithm is given an fingerprint is checks to see how many times it has seen that fingerprint.
If the fingerprint has a frequency less than the <code>minimum support</code> than it is considered anomalous.</p>
<h3 id="multiple-fingerprinters">Multiple Fingerprinters</h3>
<p>A detector instance can have more than one fingerprinting algorithm.
In this case an anomaly is determined via a consensus model or using the average support.</p>
<h4 id="consensus-model">Consensus Model</h4>
<p>Using a consensus model each fingerprinter votes for whether it thinks the window is ananomalous by comparing its support to the minimum support threshold.
If the percentage of anomalous votes is greater than a specified <code>consensus</code> threshold than the window is considered anomalous.</p>
<h4 id="average-support-model">Average Support Model</h4>
<p>Alternatively the average support from each of the fingerprinters is compared against the <code>minimum support</code> threshold.
If the average support is less than or equal to the minimum support than the window is considered anomalous.
By using the average support of the fingerprinters you essentially get a weighted voting system where each fingerprinter instead of voting yes or no gets to vote with a value between 0-1.
The average of the votes is then compared to the threshold.</p>
<h2 id="putting-it-all-together">Putting it all together</h2>
<p>Each detector instance has five parameters:</p>
<ol>
<li><code>Minimum Support</code> -- The minimum frequency a fingerprint must have in order to be considered normal.</li>
<li><code>Error Tolerance</code> -- Controls the maximum error that will be tolerated while counting fingerprints. Controls the resource usage of the algorithm.</li>
<li><code>Consensus</code> -- The percentage of fingerprinters that must agree in order to mark a window as anomalous. If the consensus is <code>-1</code> then the average support model is used.</li>
<li><code>Fingerprinters</code> -- List of fingerprinters to be used by the detector.</li>
</ol>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../fingerprints/" class="btn btn-neutral float-right" title="Fingerprints">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../configuration/" class="btn btn-neutral" title="Configuration"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/nathanielc/morgoth/" class="icon icon-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../configuration/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../fingerprints/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
